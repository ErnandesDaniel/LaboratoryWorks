
–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è –≤ Yandex

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ https://console.yandex.cloud/folders/

–°–ø—Ä–∞–≤–∞ –ø–æ—Å—Ä–µ–¥–∏ —ç–∫—Ä–∞–Ω–∞ –Ω–∞–∂–∏–º–∞–µ–º –Ω–∞ —Å–∏–Ω—é—é –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å"

–í –ø–æ—è–≤–∏–≤—à–µ–º—Å—è select-–ø–æ–ª–µ –Ω–∞—Ö–æ–¥–∏–º –∏ –≤—ã–±–∏—Ä–∞–µ–º "–ë–∞–∫–µ—Ç"

–ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–∞–∫–µ—Ç–∞ - —É–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, gitlabdev

–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —É–∫–∞–∑—ã–≤–∞–µ–º - 1 –ì–ë

–í—ã–±–∏—Ä–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ

–ù–∞–∂–∏–º–∞–µ–º "–°–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç"

–ë–∞–∫–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ —Å—Å—ã–ª–∫–µ
https://console.yandex.cloud/folders/<id-–≤–∞—à–µ–π-–ø–∞–ø–∫–∏>/storage/buckets

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Yandex Cloud CLI

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Å—Å—ã–ª–∫–µ:
https://yandex.cloud/ru/docs/cli/quickstart#install

–ü—Ä–∏–º–µ—Ä–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞:
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ yandex cloud cli –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥–Ω—É—é –æ–±–æ–ª–æ—á–∫—É (–ø–µ—Ä–µ–∑–∞–π—Ç–∏ —á–µ—Ä–µ–∑ ssh –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
–∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å source "/root/.bashrc" –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –≤ —Å–µ—Å—Å–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π PATH

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ yandex cloud cli –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ https://yandex.cloud/ru/docs/cli/quickstart#yandex-account_1 

–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–æ—Ñ–∏–ª—è CLI, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ  –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:
yc init

–ë—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–∞ –Ω–∞–¥–ø–∏—Å—å –≤—Ä–æ–¥–µ:
Please go to https://oauth.yandex.ru/authorize?response_type=token&client_id=<id –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞> in order to obtain OAuth token.

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ –¥–∞–Ω–Ω–æ–π —Å—Å—ã–ª–∫–µ, –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–î–∞–ª–µ–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –±—É–¥–µ—Ç —Å–æ–≤–µ—Ä—à–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø–æ—á—Ç–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –≥–¥–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É –±—É–¥–µ—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞

–ï–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –≤–≤–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –ø–æ—Å–ª–µ –Ω–∞–¥–ø–∏—Å–∏ "Please enter OAuth token:"

–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ Enter –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ:

You have one cloud available: '<–Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞>' (id = <id –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞>). It is going to be used by default.
Please choose folder to use:
[1] default (id = <id –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞)
[2] Create a new folder
Please enter your numeric choice:

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä –ø–∞–ø–∫–∏, –≤–≤–µ–¥–µ–º 1

–î–∞–ª–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –≤—Å–µ –≤—ã–±–æ—Ä—ã (—á–µ—Ä–µ–∑ y) –∏–ª–∏ –≤–≤–æ–¥–∏–º 1 –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É yc config list

–ß—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤ cli –±–∞–∫–µ—Ç—ã –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ:

yc storage bucket list


–°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç:
yc iam service-account create --name <–∏–º—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞>

–ù–∞–ø–∏—à–µ–º –Ω–∞–ø—Ä–∏–º–µ—Ä —Å–ª–µ–¥—É—é—â–µ–µ yc iam service-account create --name gitlabdev-storage-manager

–í—ã–≤–µ–¥–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

id: <id-—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞>
folder_id: <id-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏>
created_at: "–≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è"
name: gitlabdev-storage-manager


–ß—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∫–µ—Ç–∞–º–∏, –¥–æ–±–∞–≤—å –µ–º—É —Ä–æ–ª—å storage.editor:

yc resource-manager folder add-access-binding <id-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏> \
--role storage.editor \
--subject serviceAccount:<id-—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞>

–ü–æ–ª—É—á–∞–µ–º –≤ –æ—Ç–≤–µ—Ç —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ

effective_deltas:
- action: ADD
  access_binding:
  role_id: storage.editor
  subject:
  id: <id-—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞>
  type: serviceAccount

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ–º –∫–ª—é—á–∏ (key_id –∏ secret) –¥–ª—è —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞:

yc iam access-key create --service-account-name <–Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞>

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ:

yc iam access-key create --service-account-name gitlabdev-storage-manager

–í –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ

access_key:
id: <id –∫–ª—é—á–∞ –¥–æ—Å—Ç—É–ø–∞>
service_account_id: <id-—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞>
created_at: <–≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è>
key_id: <–∑–Ω–∞—á–µ–Ω–∏–µ key_id>
secret: <–∑–Ω–∞—á–µ–Ω–∏–µ secret>

–°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è key_id –∏ secret –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ

–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –ø–æ—è–≤–∏–ª—Å—è —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É yc iam service-account list

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å S3 - aws-cli —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã:

# –°–∫–∞—á–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
sudo apt install unzip -y
unzip awscliv2.zip

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
sudo ./aws/install

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
aws --version

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–¥ Yandex:
aws configure --profile yandex

–û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:

Access Key ID  - <key_id>
Secret Access Key  - <secret>
Default region - ru-central1
Output format - json

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–∞–∫–µ—Ç–æ–≤ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:

aws s3 ls \
--endpoint-url https://storage.yandexcloud.net \
--profile yandex

–ß—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ --endpoint-url –∏ --profile, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å alias, –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ ~/.bashrc —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ

alias aws-yandex='aws --endpoint-url https://storage.yandexcloud.net --profile yandex'

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –æ–±–æ–ª–æ—á–∫—É:
source ~/.bashrc

–¢–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–∞–∫–µ—Ç–æ–≤ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:
aws-yandex s3 ls

–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –±–∞–∫–µ—Ç–µ:

aws-yandex s3 ls s3://<–∏–º—è-–±–∞–∫–µ—Ç–∞>

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ:
aws-yandex s3 ls s3://gitlabdev

–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –≤ –±–∞–∫–µ—Ç:

aws-yandex s3 cp <–ø—É—Ç—å-–∫-—Ñ–∞–π–ª—É> s3://<–∏–º—è-–±–∞–∫–µ—Ç–∞>/<–ø—É—Ç—å-–≤-–±–∞–∫–µ—Ç–µ>/

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
aws-yandex s3 cp /root/docker-compose-gitlab-yaml-config/docker-compose.yaml s3://gitlabdev/docker-compose-gitlab-yaml-config/docker-compose.yaml

–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –∏–∑ –±–∞–∫–µ—Ç–∞ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É –≤–∏–¥–∞:

aws-yandex s3 cp s3://<–∏–º—è-–±–∞–∫–µ—Ç–∞>/<–ø—É—Ç—å-–≤-–±–∞–∫–µ—Ç–µ>/<—Ñ–∞–π–ª> <–ø—É—Ç—å-–Ω–∞-–ª–æ–∫–∞–ª—å–Ω–æ–π-–º–∞—à–∏–Ω–µ>

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ:
aws-yandex s3 cp s3://gitlabdev/docker-compose-gitlab-yaml-config/docker-compose.yaml ./docker-compose-from-bucket.yaml

–°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É /root/backup-logs-gitlab-volumes-to-s3

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –¥–ª—è –±—ç–∫–∞–ø–æ–≤ –≤ /root/ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É nano backup-gitlab-volumes-to-s3.log, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤ –≤ /root/ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É nano backup-gitlab-volumes-to-s3.sh

–°–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

#!/bin/bash

# === –ù–ê–°–¢–†–û–ô–ö–ò ===
export GITLAB_HOME="/root/docker-compose-gitlab-volumes"
CONTAINER_NAME="gitlab"                    # ‚Üê –ò–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
LOGFILE="/root/backup-logs-gitlab-volumes-to-s3/backup-gitlab-volumes-to-s3.log"
BUCKET="s3://gitlabdev/gitlab-backup/$(date +%Y/%m/%d)/"
TMP_DIR="/tmp/gitlab-backup-$(date +%s)"

# –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p "$(dirname "$LOGFILE")"

{
echo "=== –ó–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞: $(date) ==="
echo "GITLAB_HOME=$GITLAB_HOME"
echo "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: $CONTAINER_NAME"

    # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
    mkdir -p "$TMP_DIR"

    # === 1. –ó–∞–ø—É—Å–∫–∞–µ–º –±—ç–∫–∞–ø –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ===
    echo "üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º gitlab-backup create –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ $CONTAINER_NAME..."
    docker exec "$CONTAINER_NAME" gitlab-backup create CRON=1

    if [ $? -ne 0 ]; then
        echo "‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ"
        rm -rf "$TMP_DIR"
        exit 1
    fi
    echo "‚úÖ –ë—ç–∫–∞–ø —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ"

    # === 2. –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ ===
    echo "üìé –ö–æ–ø–∏—Ä—É–µ–º gitlab.rb –∏ gitlab-secrets.json..."

    cp -v "$GITLAB_HOME/config/gitlab.rb" "$TMP_DIR/gitlab.rb" 2>&1 || echo "‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω: $GITLAB_HOME/config/gitlab.rb"
    cp -v "$GITLAB_HOME/config/gitlab-secrets.json" "$TMP_DIR/gitlab-secrets.json" 2>&1 || echo "‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω: $GITLAB_HOME/config/gitlab-secrets.json"

    # === 3. –ö–æ–ø–∏—Ä—É–µ–º .tar –±—ç–∫–∞–ø—ã –∏–∑ –ø–∞–ø–∫–∏ backups ===
    BACKUP_DIR="$GITLAB_HOME/data/backups"
    if [ -d "$BACKUP_DIR" ]; then
        find "$BACKUP_DIR" -name "*.tar" -mmin -120 -type f -exec cp -v {} "$TMP_DIR/" \; 2>&1 || echo "‚ö†Ô∏è –ù–µ—Ç –Ω–æ–≤—ã—Ö .tar —Ñ–∞–π–ª–æ–≤"
    else
        echo "‚ö†Ô∏è –ü–∞–ø–∫–∞ $BACKUP_DIR –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    fi

    # === 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —á—Ç–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å ===
    if [ -z "$(ls -A "$TMP_DIR" 2>/dev/null)" ]; then
        echo "‚ùå –û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –±—ç–∫–∞–ø–∞"
        rm -rf "$TMP_DIR"
        exit 1
    fi

    # === 5. –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å—ë –≤ Yandex Object Storage ===
    echo "üì§ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –≤ $BUCKET"
    aws --endpoint-url https://storage.yandexcloud.net --profile yandex s3 cp "$TMP_DIR" "$BUCKET" --recursive

    if [ $? -eq 0 ]; then
        echo "‚úÖ –§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ $BUCKET"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤ S3"
        rm -rf "$TMP_DIR"
        exit 1
    fi

    # === 6. –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ .tar —Ñ–∞–π–ª—ã –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ ===
    echo "üßπ –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ .tar –±—ç–∫–∞–ø—ã –∏–∑ $BACKUP_DIR"
    find "$BACKUP_DIR" -name "*.tar" -mmin -120 -type f -delete 2>&1
    echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ .tar –±—ç–∫–∞–ø—ã —É–¥–∞–ª–µ–Ω—ã"

    # === 7. –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É ===
    rm -rf "$TMP_DIR"

    echo "=== –ë—ç–∫–∞–ø –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ ==="

} >> "$LOGFILE" 2>&1

–î–∞–ª–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã:
chmod +x /root/backup-gitlab-volumes-to-s3.sh

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
/root/backup-gitlab-volumes-to-s3.sh

–û—Ç–∫—Ä—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä cron —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:

crontab -e

–î–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É:

0 2 * * * /root/backup-gitlab-volumes-to-s3.sh

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ